<!doctype html>
<% include helpers.ejs %>
<html lang="en">
<head>
    <title><%= getByKey("title", title) %></title>
    <meta charset="utf-8">
    <base href="/">
    <meta name="description" content="<%= getByKey("description", description) %>">
    <meta name="keywords" content="<%= getByKey("keywords", keywords) %>">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <meta name="google-site-verification" content="y44WuK2ZR66lvH1A_awHiF5xZAnuldnjUJ2cFWTlH_I" />

    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="<%= fixUrl(current.path, 'content/img/ico/ms-icon-144x144.png') %>">
    <meta name="theme-color" content="#ffffff">

    <link rel="apple-touch-icon" sizes="57x57"
          href="<%= fixUrl(current.path, 'content/img/ico/apple-icon-57x57.png') %>">
    <link rel="apple-touch-icon" sizes="60x60"
          href="<%= fixUrl(current.path, 'content/img/ico/apple-icon-60x60.png') %>">
    <link rel="apple-touch-icon" sizes="72x72"
          href="<%= fixUrl(current.path, 'content/img/ico/apple-icon-72x72.png') %>">
    <link rel="apple-touch-icon" sizes="76x76"
          href="<%= fixUrl(current.path, 'content/img/ico/apple-icon-76x76.png') %>">
    <link rel="apple-touch-icon" sizes="114x114"
          href="<%= fixUrl(current.path, 'content/img/ico/apple-icon-114x114.png') %>">
    <link rel="apple-touch-icon" sizes="120x120"
          href="<%= fixUrl(current.path, 'content/img/ico/apple-icon-120x120.png') %>">
    <link rel="apple-touch-icon" sizes="144x144"
          href="<%= fixUrl(current.path, 'content/img/ico/apple-icon-144x144.png') %>">
    <link rel="apple-touch-icon" sizes="152x152"
          href="<%= fixUrl(current.path, 'content/img/ico/apple-icon-152x152.png') %>">
    <link rel="apple-touch-icon" sizes="180x180"
          href="<%= fixUrl(current.path, 'content/img/ico/apple-icon-180x180.png') %>">
    <link rel="icon" type="image/png" sizes="192x192"
          href="<%= fixUrl(current.path, 'content/img/ico/android-icon-192x192.png') %>">
    <link rel="icon" type="image/png" sizes="32x32"
          href="<%= fixUrl(current.path, 'content/img/ico/favicon-32x32.png') %>">
    <link rel="icon" type="image/png" sizes="96x96"
          href="<%= fixUrl(current.path, 'content/img/ico/favicon-96x96.png') %>">
    <link rel="icon" type="image/png" sizes="16x16"
          href="<%= fixUrl(current.path, 'content/img/ico/favicon-16x16.png') %>">
    <link rel="manifest" href="<%= fixUrl(current.path, 'content/img/ico/manifest.json') %>">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css"
          integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900&amp;subset=cyrillic"
          rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.10/css/all.css"
          integrity="sha384-+d0P83n9kaQMCwj8F4RJB66tzIwOKmrdb46+porD/OvrJ+37WqIM7UoBtwHO6Nlg" crossorigin="anonymous">
    <link rel="stylesheet" href="<%= prefixUrl() %>content/css/style.css">
    <link rel="stylesheet" href="<%= prefixUrl() %>js/libs/slick/slick-all.css">
</head>
<body id="top">

<%- partial("/shared/_header") %>
<%- yield %>

<script src="https://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"
        integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"
        integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm"
        crossorigin="anonymous"></script>
<script src="<%= prefixUrl() %>js/libs/slick/slick.min.js"></script>
<script>
    function getCookie(cname) {
        var name = cname + "=";
        var decodedCookie = decodeURIComponent(document.cookie);
        var ca = decodedCookie.split(';');
        for (var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == ' ') {
                c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
                return c.substring(name.length, c.length);
            }
        }
        return "";
    }

    function setCookie(name, value, days) {
        var expires = "";
        if (days) {
            var date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            expires = "; expires=" + date.toUTCString();
        }
        document.cookie = name + "=" + (value || "") + expires + "; path=/";
    }

    function CookiePolicyManager() {
        var self = this;

        self.registerEvents = function () {
            $('.navbar-cookies a#acceptCookiePolicy').click(self.acceptCookies);
        };

        self.acceptCookies = function () {
            setCookie('enable_cookies', true, 365 * 3);
            $('.navbar-cookies').addClass('d-none');
            return false;
        }

        self.showCookieInformation = function () {
            if (document.cookie.indexOf('enable_cookies=') <= 0) {
                $('.navbar-cookies').removeClass('d-none');
            }
        };
    }

    function LanguageManager() {
        var self = this;

        self.languages = ['en', 'de', 'ru'];
        self.languagePaths = ['/', '/de/', '/ru/'];

        self.isLanguagePath = function () {
            return self.languagePaths.indexOf(location.pathname) !== -1;
        }

        self.registerEvents = function () {
            $('.language-switch a').click(self.changeLanguage);
        }

        self.changeLanguage = function () {
            setCookie('language', $(this).data('language'), 365 * 3);
            self.switchToLanguage();
            return false;
        };

        self.switchToLanguage = function () {
            var language = getCookie('language');

            if (!language ||
                !self.isLanguagePath() ||
                (location.pathname === '/' && language === 'en') || location.pathname === '/' + language + '/') {
                return false;
            }

            location.pathname = language === 'en' ? '/' : language + '/';
            return true;
        };

        self.updateUi = function () {
            var language = getCookie('language') || self.getLanguageFromPath();

            if (language) {
                $('#language-switch-btn span').each(function () {
                    if ($(this).data('language') === language) {
                        $(this).removeClass('d-none');
                    } else {
                        $(this).addClass('d-none');
                    }
                });
            }
        };

        self.getLanguageFromPath = function () {
            var idx = self.languagePaths.indexOf(location.pathname);

            return idx === -1 ? null : self.languages[idx];
        }
    }

    var cookiePolicyMgr = new CookiePolicyManager();
    var langMgr = new LanguageManager();

    cookiePolicyMgr.showCookieInformation();
    langMgr.updateUi();

    if (!langMgr.switchToLanguage()) {
        $(document).ready(function () {
            cookiePolicyMgr.registerEvents();
            langMgr.registerEvents();

            $('.carousel').carousel({
                interval: 10000
            });


            $('.flip-container').click(function () {
                this.classList.toggle("clicked");
            })


            $('.blc-articles .items').slick({
                dots: true,
                infinite: true,
                slidesToShow: 4,
                slidesToScroll: 4,
                autoplay: true,
                autoplaySpeed: 2000,
                swipeToSlide: true,
                responsive: [
                    {
                        breakpoint: 768,
                        settings: {
                            dots: false,
                            slidesToShow: 1,
                            slidesToScroll: 1
                        }
                    }
                ]
            });


            function onScroll() {
                var scrollPos = $(document).scrollTop();

                $('.blc-navbar .navbar-nav a[href*="#"]:not([href="#"])').each(function () {
                    var currLink = $(this);

                    var refElement = $(currLink[0].hash);
                    if (refElement.position().top <= scrollPos && refElement.position().top + refElement.height() + 75 > scrollPos) {
                        $('.blc-navbar .navbar-nav a[href*="#"]:not([href="#"])').removeClass("active");
                        currLink.addClass("active");
                    }
                    else {
                        currLink.removeClass("active");
                    }
                });
            }

            if (langMgr.isLanguagePath()) {
                $(document).on("scroll", onScroll);

                // Smooth scrolling. From https://css-tricks.com/snippets/jquery/smooth-scrolling/#comment-197181
                $('.blc-navbar .navbar-nav a[href*="#"]:not([href="#"])').click(function (e) {
                    if (location.pathname.replace(/^\//, '') === this.pathname.replace(/^\//, '') || location.hostname === this.hostname) {
                        e.preventDefault();

                        $(document).off("scroll");
                        $('a').each(function () {
                            $(this).removeClass('active');
                        });
                        $(this).addClass('active');

                        var target = $(this.hash);
                        target = target.length ? target : $('[name=' + this.hash.slice(1) + ']');
                        if (target.length) {
                            $('html,body').animate({
                                scrollTop: target.offset().top + 5
                            }, 1000, 'swing', function () {
                                window.location.hash = target.attr('id');
                                $(document).on("scroll", onScroll);
                            });
                            return true;
                        }
                    }
                });
            }
        });
    }
</script>
<script>
    (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'UA-112962931-3', 'auto');
    ga('send', 'pageview');
</script>
</body>
</html>
